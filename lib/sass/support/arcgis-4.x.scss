// ┌───────────────────────┐
// │ ArcGIS JS 4.x Support │
// └───────────────────────┘
//
// Themes and layout for widgets
//
// NOTE: Will change to integrate ArcGIS JS 4.x Sass in the near future!

@import "../variables";
@import "../mixins";

$arcgis_widget_margin: 15px;
$arcgis_widget_min_width: 250px;
$arcgis_widget_full_width: 100%;

// Widget light color variables
$theme_light_arcgis_widget_border: rgba(0, 0, 0, 0.25);

// Widget dark color variables
$theme_dark_arcgis_widget_border: rgba($Calcite_Gray_700_Dark, 0.2);
// $theme_dark_arcgis_widget_border: rgba(125, 125, 125, 0.75);
$theme_dark_arcgis_widget_shadow: rgba(55, 55, 55, 0.5);
$theme_dark_arcgis_active_background: $Calcite_Gray_300_Dark;
$theme_dark_arcgis_active_text_color: $Calcite_Gray_700_Dark;
$theme_dark_arcgis_disabled_text_color: $Calcite_Gray_350_Dark;

// Search expander
$search_expander_width: 254px;
$search_expander_width_mobile_xxs: 200px;
$text_dark_widget_border_color: rgba(0, 0, 0, 0.30);
$text_light_widget_border_color: rgba(255, 255, 255, 0.7);

// --------------------------------------------------
// View
// --------------------------------------------------

.esri-view {
  position: absolute;
  height: 100%;
  width: 100%;
}

// --------------------------------------------------
// Widgets
// --------------------------------------------------

// Buttons

.esri-widget-button {
  z-index: 1;
}

// Basemaptoggle

.esri-basemap-toggle {
  z-index: 1px;
}

// Legend

.esri-legend {
  overflow: hidden;
  padding: 0;
}

// ColorPicker

.calcite-panels {
  .esri-color-picker {
    width: 100%;
  }
}

// Popup - Enable body collapse

.esri-popup .esri-show-title .esri-title {
  cursor: pointer;
}

.esri-popup .esri-popup-collapsed .esri-popup-header .esri-popup-header-buttons {
  padding-top: 3px;
}

.esri-popup .esri-popup-collapsed .esri-popup-content, 
.esri-popup .esri-popup-collapsed.esri-show-footer .esri-footer {
  display: none;
}

.esri-popup .esri-show-dock .esri-dock {
  z-index: 1;
}

// Popup - Nav top

.calcite-nav-top,
.calcite-nav-top-fixed {
  
  .esri-popup .esri-docked {
    margin: $arcgis_widget_margin $arcgis_widget_margin ($arcgis_widget_margin * 2) $arcgis_widget_margin !important;
  }
}

// Popup - Nav bottom

.calcite-nav-bottom,
.calcite-nav-bottom-fixed { 
    
  .esri-popup .esri-docked {
    margin: ($arcgis_widget_margin * 2) $arcgis_widget_margin $arcgis_widget_margin $arcgis_widget_margin !important;
  }
}

// Attribution - Top and bottom

.calcite-nav-top .esri-attribution,
.calcite-nav-top-fixed .esri-attribution {
    top: auto;
    bottom: 0;
}

.calcite-nav-bottom .esri-ui .esri-attribution,
.calcite-nav-bottom-fixed .esri-ui .esri-attribution {
    top: 0;
    bottom: auto;
}

// Search - Display menu upwards in nav

.calcite-nav-bottom .navbar .esri-widget .esri-menu,
.calcite-nav-bottom-fixed .navbar .esri-widget .esri-menu {
  top: auto;
  bottom: 36px;
}

.esri-search .esri-search__input {
  line-height: 1;
}

// --------------------------------------------------
// Search in Navbar
// --------------------------------------------------

// Search widget in nav or forms

.calcite-navbar {

  .calcite-navbar-search {
    .esri-search {
      -webkit-box-shadow: none;
      box-shadow: none;
    }
  }

  // --------------------------------------------------
  // Search Expander
  // --------------------------------------------------

  // Transitions

  .calcite-navbar-search {
    &.calcite-search-expander {
      padding-right: 0;
      padding-left: 5px;
      
       // Prevent lost focus on mouse move
      .esri-search .esri-search__container::before {
        content: " ";
        position: absolute;
        top: -10px;
        left: 0;
        height: 10px;
        width: 100%;
        display: block;
        background-color: transparent;
      }
      // Prevent lost focus on mouse move
      .esri-search .esri-search__container::after {
        content: " ";
        position: absolute;
        bottom: -10px;
        left: 0;
        height: 10px;
        width: 100%;
        display: block;
        background-color: transparent;
      }
      // Default state
      .esri-search {
        width: 100%;
        .esri-search__container {
          width: 32px;
          -webkit-transition: width 0.35s ease-out;
          -moz-transition: width 0.35s ease-out;
          -o-transition: width 0.35s ease-out;
          transition: width 0.35s ease-out;
        }
        .esri-search__input {
          display: none;
          z-index: 1;
        }
        .esri-search--show-suggestions .esri-search__suggestions-menu,
        .esri-search--no-results .esri-search__no-results-menu,
        .esri-search--has-value .esri-search__clear-button {
          display: none;
        }
      }
      // Hover/focus state
      .esri-search:hover,
      .esri-search:focus {
        .esri-search__container {
          width: $search_expander_width;
        }
        .esri-search__input {
          display: block;
        }
        .esri-search--show-suggestions .esri-search__suggestions-menu,
        // .esri-search--no-results .esri-search__no-results-menu,
        .esri-search--has-value .esri-search__clear-button {
          display: flex;
        }
      }
    }
  } //calcite-search-expander

  // Borders and Color - Text Dark - Default state

  &.calcite-text-dark {
    .calcite-search-expander .esri-widget.esri-search {
      border-color: transparent;
      .esri-search__submit-button {
        border-color: transparent;
        color: $theme_light_navbar_text_color;
      } 
    }
  }

  &.calcite-text-light {
    .calcite-search-expander .esri-widget.esri-search {
      border-color: transparent;
      .esri-search__submit-button {
        border-color: transparent;
        color: $theme_dark_navbar_text_color;
      } 
    }
  }

  // Borders and Color - Text Light - Hover/focus state

  &.calcite-text-dark {
    .calcite-search-expander .esri-widget.esri-search:hover,
    .calcite-search-expander .esri-widget.esri-search:focus {
      border-color: $text_dark_widget_border_color;
      .esri-search__submit-button {
        border-color: $text_dark_widget_border_color;
      } 
    }
  }

  &.calcite-text-light {
    .calcite-search-expander .esri-widget.esri-search:hover,
    .calcite-search-expander .esri-widget.esri-search:focus {
      border-color: $text_light_widget_border_color; 
      .esri-search__submit-button {
        border-color: $text_light_widget_border_color;
      } 
    }
  }
}

// --------------------------------------------------
// Search Expander - Themes
// --------------------------------------------------

.calcite-navbar {

  // Light Theme, Dark Text

  &.calcite-text-dark {
    
    .calcite-search-expander {  

      .esri-search {
        background-color: transparent;
        border: 1px solid $text_dark_widget_border_color; 
      }

      .esri-widget, 
      .esri-widget-button {
        color: $theme_light_control_text_color;
      }

      .esri-widget-button {
        background-color: transparent;
      }

      .esri-widget-button.esri-disabled {
        color: $theme_light_control_text_color_disabled;
      }

      .esri-search__input {
        @include custom-theme-placholder($theme_light_control_text_color, .5); 
        color: $theme_light_control_text_color;
      }

      .esri-search__submit-button {
        //border-left: solid 1px $text_dark_widget_border_color;
        color: $theme_light_control_text_color;
      }

      .esri-widget-button:active,
      .esri-widget-button:hover,
      .esri-search__submit-button:hover,
      .esri-search__clear-button:hover {
        background-color: $theme_custom_dropdown_menu_bg_hover;
        color: $theme_light_control_text_color_hover;
      }

      .esri-menu li {
        background-color: $theme_light_dropdown_menu_bg;
        color: $theme_light_control_text_color;
      }

      .esri-menu li:focus,
      .esri-menu li:hover {
        background-color: $theme_light_dropdown_menu_bg_hover;
        color: $theme_light_control_text_color_hover;
      }
    }
  }

  // Dark Theme, Light Text

  &.calcite-text-light {
    
    .calcite-search-expander {  

      .esri-search {
        background-color: transparent;
        border: 1px solid $text_light_widget_border_color; 
      }

      .esri-widget, 
      .esri-widget-button {
        color: $theme_dark_control_text_color;
      }

      .esri-widget-button {
        background-color: transparent;
      }

      .esri-widget-button.esri-disabled {
        color: $theme_dark_control_text_color_disabled;
      }

      .esri-search__input {
        @include custom-theme-placholder($theme_dark_control_text_color, .5); 
        color: $theme_dark_control_text_color;
      }

      .esri-search__submit-button {
        //border-left: solid 1px $text_light_widget_border_color;
        color: $theme_dark_control_text_color;
      }

      .esri-widget-button:active,
      .esri-widget-button:hover,
      .esri-search__submit-button:hover,
      .esri-search__clear-button:hover {
        background-color: $theme_custom_dropdown_menu_bg_hover;
        color: $theme_dark_control_text_color_hover;
      }

      .esri-menu li {
        background-color: $theme_light_dropdown_menu_bg;
        color: $theme_light_control_text_color;
      }

      .esri-menu li:focus,
      .esri-menu li:hover {
        background-color: $theme_light_dropdown_menu_bg_hover;
        color: $theme_light_control_text_color_hover;
      }
    }
  }
}

// --------------------------------------------------
// Panels - Widgets
// --------------------------------------------------

.calcite-panels {

  .esri-search {
    width:  $arcgis_widget_full_width;
    -webkit-box-shadow: none;
    box-shadow: none;
  }
  
  .esri-search .esri-search__input {
    border: none;
  }

  .esri-search .esri-menu {
    width: calc(100% + 2px);
    left: -1px;
  }

  .esri-legend {
    width: $arcgis_widget_full_width;
    padding: 0;
    -webkit-box-shadow: none;
    box-shadow: none;
  }
}

// --------------------------------------------------
// Calcite - Light theme (defaults)
// --------------------------------------------------

.calcite-navbar,
.calcite-panels {
  &.calcite-bg-light {

    .esri-search {
      border: 1px solid $theme_light_arcgis_widget_border;
    }
  }
}

// --------------------------------------------------
// Calcite - Dark theme
// --------------------------------------------------

.calcite-navbar,
.calcite-panels {
  &.calcite-bg-dark {

    .esri-search {
      border: 1px solid $theme_dark_arcgis_widget_border;
    }
  }
}

// --------------------------------------------------
// Widgets - Dark theme 
// --------------------------------------------------

.calcite-widgets-dark {

  .esri-widget.esri-search,
  .esri-widget .esri-popup,
  .esri-widget.esri-legend,
  .esri-widget .esri-menu,
  .esri-widget-button,
  .esri-popup .esri-popup-main,
  .esri-popup .esri-pointer .esri-pointer-direction,
  .esri-popup .esri-button {
    background-color: $theme_dark_control_bg;
    color: $theme_dark_control_text_color;
  }

  .esri-widget-button:focus,
  .esri-widget-button:hover,
  .esri-widget .esri-menu li:focus,
  .esri-widget .esri-menu li:hover {
    background-color: $theme_dark_control_bg_hover;
    color: $theme_dark_control_text_color_hover;
  }

  .esri-widget-button:active,
  .esri-widget-button:hover,
  .esri-search .esri-search__clear-button:hover {
    background-color: $theme_dark_arcgis_active_background;
    color: $theme_dark_arcgis_active_text_color;
  }

  .esri-widget-button.esri-disabled {
    color: $theme_dark_arcgis_disabled_text_color;
  }

  .esri-zoom {
    .esri-widget-button {
      &:last-child {
        border-top: solid 1px $theme_dark_arcgis_widget_border;
      }
    }
  }

  .esri-search,
  .esri-zoom,
  .esri-widget-button {
    -webkit-box-shadow: 0 1px 2px $theme_dark_arcgis_widget_shadow;
    box-shadow: 0 1px 2px $theme_dark_arcgis_widget_shadow;
  }

  .esri-search,
  .esri-zoom {
    .esri-widget-button {
      -webkit-box-shadow: none;
      box-shadow: none;
    }
  }

  // Search

  .esri-search {
    .esri-search__submit-button {
      border-left: solid 1px $theme_dark_arcgis_widget_border;
    }
  }

  .esri-widget {
    .esri-menu li {
      border-top: solid 1px $theme_dark_arcgis_widget_border;
    }
  }

  // Search (in nav or panels)

  .calcite-navbar {
    .esri-search {
      border: 1px solid $theme_dark_control_border_color;
    }
  }

  .calcite-panels {
    .esri-search {
      border: 1px solid $theme_dark_control_border_color;
    }
  }

  // Popup

  .esri-popup .esri-button:focus,
  .esri-popup .esri-button:hover {
    color: $theme_dark_control_text_color_hover;  
  }

  .esri-widget table {
    color: $theme_dark_control_text_color;
  }

  .esri-widget table tr:nth-child(even) {
    background-color: rgba(51,51,51,0.7)
  }

  .esri-widget table tr:nth-child(odd) {
    background-color: rgba(250,250,250,0.1)
  }

  .esri-popup .esri-popup-content::-webkit-scrollbar {
    background-color: rgba(200,200,200,0.2);
  }

  .esri-popup .esri-popup-content::-webkit-scrollbar-thumb {
    background-color: rgba(200,200,200,0.6);
  }

} 

@media (max-width: $base_breakpoint_width_mobile_xxs) {
  .calcite-navbar {
    .calcite-navbar-search {
      &.calcite-search-expander {
        .esri-search:hover,
        .esri-search:focus {
          .esri-search__container {
            width: $search_expander_width_mobile_xxs;
          }
        }
      }
    }
  }
}

